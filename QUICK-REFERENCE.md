# ğŸ¯ å‡½æ•°ç®¡ç†å¿«é€Ÿå‚è€ƒ

## ğŸ“ åœ¨å“ªé‡Œç®¡ç†å·²æ³¨å†Œçš„å‡½æ•°ï¼Ÿ

### ä¸»è¦é¡µé¢ï¼šå‡½æ•°ç›®å½• â­

**è·¯å¾„**ï¼š`æ¸¸æˆç®¡ç† â†’ å‡½æ•°ç®¡ç† â†’ å‡½æ•°ç›®å½•`

**URL**ï¼š`http://localhost:8000/game/functions/catalog`

---

## ğŸ“‹ æ‰€æœ‰ç›¸å…³é¡µé¢

| é¡µé¢åç§° | è·¯å¾„ | åŠŸèƒ½ |
|---------|------|------|
| **å‡½æ•°ç›®å½•** â­ | `/game/functions/catalog` | æŸ¥çœ‹æ‰€æœ‰å·²æ³¨å†Œå‡½æ•° |
| **å‡½æ•°å®ä¾‹** | `/game/functions/instances` | æŸ¥çœ‹å‡½æ•°è¿è¡Œå®ä¾‹ |
| **OpenAPI å¯¼å…¥** ğŸ†• | `/game/functions/import-openapi` | å¯¼å…¥ OpenAPI è§„èŒƒ |
| **å‡½æ•°åˆ†é…** | `/game/functions/assignments` | ç®¡ç†å‡½æ•°æƒé™ |
| **Pack ç®¡ç†** | `/game/functions/packs` | ç®¡ç† Pack æ–‡ä»¶ |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æŸ¥çœ‹å·²æ³¨å†Œçš„å‡½æ•°

1. æ‰“å¼€ Dashboard: http://localhost:8000
2. ç‚¹å‡»å·¦ä¾§èœå•ï¼š**æ¸¸æˆç®¡ç†** â†’ **å‡½æ•°ç®¡ç†**
3. ç‚¹å‡» **å‡½æ•°ç›®å½•**
4. æŸ¥çœ‹æ‰€æœ‰é€šè¿‡ Agent æ³¨å†Œçš„å‡½æ•°

**ä½ ä¼šçœ‹åˆ°**ï¼š
```
examples.player.create        (ç©å®¶åˆ›å»º)
examples.player.get           (ç©å®¶æŸ¥è¯¢)
examples.player.delete        (ç©å®¶åˆ é™¤)
...
packs.http.generic_invoke     (HTTP è°ƒç”¨)
packs.prom.query             (Prometheus æŸ¥è¯¢)
packs.player.ban              (ç©å®¶å°ç¦)
...
```

### å¯¼å…¥æ–°çš„ OpenAPI å‡½æ•°

1. ç‚¹å‡» **å‡½æ•°ç®¡ç†** â†’ **OpenAPI å¯¼å…¥**
2. ç²˜è´´ä½ çš„ OpenAPI YAML/JSON å†…å®¹
3. ç‚¹å‡» **å¯¼å…¥å‡½æ•°**
4. æŸ¥çœ‹å¯¼å…¥ç»“æœ
5. è¿”å› **å‡½æ•°ç›®å½•** æŸ¥çœ‹æ–°å‡½æ•°

---

## ğŸ¨ é¡µé¢ç¤ºä¾‹

### å‡½æ•°ç›®å½•é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” æœç´¢å‡½æ•°...              ç­›é€‰ â–¼             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åˆ†ç±»: å…¨éƒ¨ â–¼  æ ‡ç­¾: å…¨éƒ¨ â–¼  é£é™©: å…¨éƒ¨ â–¼        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å‡½æ•°åˆ—è¡¨                                      â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ examples.player.create                 â”‚    â”‚
â”‚ â”‚ åˆ›å»ºç©å®¶ | ä½é£é™© | player           â”‚    â”‚
â”‚ â”‚ [æŸ¥çœ‹è¯¦æƒ…] [OpenAPI] [è°ƒç”¨]           â”‚    â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚ â”‚ packs.http.generic_invoke             â”‚    â”‚
â”‚ â”‚ HTTP é€šç”¨è°ƒç”¨ | ä½é£é™© | http          â”‚    â”‚
â”‚ â”‚ [æŸ¥çœ‹è¯¦æƒ…] [OpenAPI] [è°ƒç”¨]           â”‚    â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚ â”‚ player_service.player.create           â”‚    â”‚
â”‚ â”‚ åˆ›å»ºç©å®¶ | ä½é£é™© | player_service    â”‚    â”‚
â”‚ â”‚ [æŸ¥çœ‹è¯¦æƒ…] [OpenAPI] [è°ƒç”¨]           â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### OpenAPI å¯¼å…¥é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¯¼å…¥ OpenAPI 3.0.3 è§„èŒƒ                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                â”‚
â”‚ ç²˜è´´ OpenAPI æ–‡ä»¶å†…å®¹:                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ {                                      â”‚    â”‚
â”‚ â”‚   "openapi": "3.0.3",                 â”‚    â”‚
â”‚ â”‚   "info": {                            â”‚    â”‚
â”‚ â”‚     "title": "My API",                 â”‚    â”‚
â”‚ â”‚     "version": "1.0.0"                â”‚    â”‚
â”‚ â”‚   },                                   â”‚    â”‚
â”‚ â”‚   "paths": {                           â”‚    â”‚
â”‚ â”‚     "/player/create": {               â”‚    â”‚
â”‚ â”‚       "post": {                        â”‚    â”‚
â”‚ â”‚         "operationId": "player.create",â”‚    â”‚
â”‚ â”‚         ...                            â”‚    â”‚
â”‚ â”‚       }                                â”‚    â”‚
â”‚ â”‚     }                                  â”‚    â”‚
â”‚ â”‚   }                                    â”‚    â”‚
â”‚ â”‚ }                                      â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                â”‚
â”‚                 [å¯¼å…¥å‡½æ•°] [é‡ç½®]               â”‚
â”‚                                                â”‚
â”‚ ç»“æœ:                                         â”‚
â”‚ âœ… æˆåŠŸå¯¼å…¥ 13 ä¸ªå‡½æ•°                           â”‚
â”‚ âš ï¸  å¤±è´¥ 0 ä¸ªå‡½æ•°                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” å¦‚ä½•è¯†åˆ«å·²æ³¨å†Œçš„å‡½æ•°ï¼Ÿ

### é€šè¿‡å‡½æ•° ID å‰ç¼€

| å‰ç¼€ | æ¥æº | ç¤ºä¾‹ |
|------|------|------|
| `examples.*` | OpenAPI ç¤ºä¾‹æ–‡ä»¶ | `examples.player.create` |
| `packs.*` | Packs | `packs.http.generic_invoke` |
| `{service}_*` | è‡ªå®šä¹‰æœåŠ¡ | `player_service.player.create` |

### é€šè¿‡å‡½æ•°è¯¦æƒ…

ç‚¹å‡»å‡½æ•°åç§°æŸ¥çœ‹è¯¦æƒ…ï¼š
- **Summary**: å‡½æ•°æè¿°
- **Tags**: æ ‡ç­¾åˆ†ç±»
- **x-risk**: é£é™©ç­‰çº§
- **x-operation**: æ“ä½œç±»å‹

---

## ğŸ’¡ å¸¸ç”¨æ“ä½œ

### æŸ¥çœ‹å‡½æ•°çš„ OpenAPI è§„èŒƒ

**æ–¹å¼ 1**ï¼šåœ¨å‡½æ•°ç›®å½•é¡µé¢
1. æ‰¾åˆ°å‡½æ•°
2. ç‚¹å‡» "OpenAPI" æŒ‰é’®
3. æŸ¥çœ‹å®Œæ•´çš„ OpenAPI è§„èŒƒ

**æ–¹å¼ 2**ï¼šç›´æ¥è®¿é—® URL
```
/game/functions/{function_id}/openapi

ä¾‹å¦‚ï¼š
/game/functions/examples.player.create/openapi
```

### æµ‹è¯•å‡½æ•°è°ƒç”¨

1. åœ¨å‡½æ•°ç›®å½•é¡µé¢æ‰¾åˆ°å‡½æ•°
2. ç‚¹å‡» "è°ƒç”¨" æŒ‰é’®
3. å¡«å†™è¯·æ±‚å‚æ•°
4. å‘é€è°ƒç”¨
5. æŸ¥çœ‹å“åº”ç»“æœ

### å¯¼å‡ºå‡½æ•°å®šä¹‰

1. ç‚¹å‡» "æŸ¥çœ‹ OpenAPI"
2. ç‚¹å‡» "å¤åˆ¶è§„èŒƒ"
3. ç²˜è´´åˆ°ä½ çš„é¡¹ç›®

---

## ğŸ“Š å‡½æ•°æ¥æºè¯´æ˜

### é€šè¿‡ Agent æ³¨å†Œçš„å‡½æ•°

å½“ä½ å¯åŠ¨ Agent æ—¶ï¼Œä¼šè‡ªåŠ¨æ³¨å†Œä»¥ä¸‹å‡½æ•°ï¼š

#### 1. ç¤ºä¾‹å‡½æ•°ï¼ˆ13 ä¸ªï¼‰

æ¥æºï¼š`services/agent/etc/openapi.example.yaml`

```yaml
examples.player.create
examples.player.get
examples.player.update_profile
examples.player.delete
examples.player.ban_batch
examples.inventory.get
examples.player.upload_avatar
examples.player.list
examples.chat.send_message
examples.game.trigger_event
examples.config.set
examples.analytics.player_retention
examples.player.get_stats_legacy
```

#### 2. Pack å‡½æ•°ï¼ˆ6 ä¸ªï¼‰

æ¥æºï¼š`packs/*/openapi.yaml`

```yaml
packs.http.generic_invoke
packs.prom.query
packs.prom.query_range
packs.player.ban
packs.grafana.search_dashboards
packs.alertmanager.list_alerts
```

#### 3. è‡ªå®šä¹‰æœåŠ¡å‡½æ•°

æ¥æºï¼š`services/agent/etc/platforms.yaml`

å¦‚æœé…ç½®äº†å¾®æœåŠ¡ï¼Œä¼šçœ‹åˆ°ï¼š
```yaml
player_service.player.create
inventory_service.item.add
chat_service.message.send
```

---

## ğŸ¯ æ¨èå·¥ä½œæµ

### å¼€å‘æ–°å‡½æ•°

```
1. ç¼–å†™ OpenAPI æ–‡ä»¶
   â†“
2. å¯åŠ¨ Agentï¼ˆè‡ªåŠ¨æ³¨å†Œï¼‰
   â†“
3. åœ¨ Dashboard æŸ¥çœ‹
   â†“
4. æµ‹è¯•å‡½æ•°è°ƒç”¨
   â†“
5. é…ç½®å‡½æ•°æƒé™
```

### æ‰¹é‡å¯¼å…¥å‡½æ•°

```
1. å‡†å¤‡ OpenAPI æ–‡ä»¶
   â†“
2. Dashboard â†’ OpenAPI å¯¼å…¥
   â†“
3. ç²˜è´´å†…å®¹å¹¶å¯¼å…¥
   â†“
4. æŸ¥çœ‹å¯¼å…¥ç»“æœ
   â†“
5. å‡½æ•°ç›®å½•éªŒè¯
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å®Œæ•´å‡½æ•°ç®¡ç†æŒ‡å—](./FUNCTION-MANAGEMENT-GUIDE.md)
- [Agent OpenAPI é…ç½®](../services/agent/etc/README-OPENAPI.md)
- [OpenAPI ç¤ºä¾‹æ–‡ä»¶](../services/agent/etc/openapi.example.yaml)

---

**å¿«é€Ÿè®¿é—®**ï¼š
- ğŸ  Dashboard: http://localhost:8000
- ğŸ“‹ å‡½æ•°ç›®å½•: http://localhost:8000/game/functions/catalog
- ğŸ“¥ å¯¼å…¥é¡µé¢: http://localhost:8000/game/functions/import-openapi

**æœ€åæ›´æ–°**: 2024-02-07
