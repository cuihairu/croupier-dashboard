# 🎨 可视化配置使用指南

## 📋 概述

函数详情页面现在支持 **可视化配置**，无需使用 curl 命令或手动编辑 JSON 文件！

---

## 🎯 访问配置页面

### **方法 1：从函数目录访问**

1. 访问 `/game/functions/catalog`
2. 找到您要配置的函数
3. 点击操作列的 **查看详情** 按钮（或点击函数名）

### **方法 2：直接访问**

```
http://localhost:8000/functions/{function_id}
```

例如：`http://localhost:8000/functions/player.get`

---

## 🎨 配置功能

### **1. 基本信息编辑**（信息 Tab）

| 字段 | 说明 | 示例 |
|------|------|------|
| 函数名称 | 显示名称 | 获取玩家信息 |
| 描述 | 详细说明 | 根据玩家ID获取玩家详细信息 |
| 分类 | 函数分类 | player |
| 标签 | 搜索标签 | 玩家,查询,基础 |

**操作步骤**：
1. 点击 **"编辑"** 按钮
2. 修改表单字段
3. 点击 **"保存"** 按钮

---

### **2. 权限配置**（权限 Tab）⭐

**功能**：控制哪些角色可以调用该函数

**配置项**：
- `resource`: 资源标识（通常为 `function`）
- `actions`: 允许的操作（`invoke`, `execute`, `read` 等）
- `roles`: 允许的角色列表（`admin`, `gm`, `operator` 等）
- `env`: 环境限制（留空表示所有环境）

**操作步骤**：
1. 切换到 **"权限"** Tab
2. 查看现有规则列表
3. 点击 **"添加规则"** 按钮新增规则
4. 填写表单字段：
   - resource: `function`
   - actions: 勾选 `invoke`, `execute`
   - roles: 输入角色名（支持多个）
   - env: 留空或指定环境
5. 点击 **"保存权限"** 按钮

**示例配置**：
```
规则 #1:
  resource: function
  actions: [invoke, execute]
  roles: [admin, gm, operator]
  env: (all)
```

**无需使用 curl**！完全在 Web 界面操作。✨

---

### **3. UI 配置**（配置 → UI 配置 Tab）

**功能**：配置函数参数表单的显示方式

**当前支持**：
- ✅ 查看当前布局类型（grid/tabs）
- ✅ 查看当前列数设置
- ⚠️ 完整编辑功能开发中

**配置项**：
- `布局类型`: 网格布局 或 标签页布局
- `列数`: 1-4 列（仅网格布局有效）

**注意**：目前 UI Schema 的完整编辑需要：
1. 编辑 Pack 文件中的 `ui/*.uischema.json`
2. 重新打包
3. 上传新 Pack

---

### **4. 路由配置**（配置 → 路由配置 Tab）

**功能**：配置函数在前端菜单中的显示和跳转路径

**配置项**：

| 字段 | 说明 | 示例 |
|------|------|------|
| `section` | 一级菜单 | 玩家管理 |
| `group` | 二级分组 | 基础功能 |
| `path` | 路由路径 | `/game/player/get` |
| `order` | 显示顺序 | 10（数字越小越靠前）|
| `hidden` | 是否隐藏 | false |

**操作步骤**：
1. 切换到 **"配置"** → **"🛣️ 路由配置"** Tab
2. 查看当前路由配置
3. 修改表单字段
4. **注意**：修改后需要重新导出 Pack 才能生效

**路由示例**：
```
配置后点击"调用函数"按钮会跳转到：
  /game/player/get?fid=player.get

如果不配置 path，则使用默认路径：
  /game/functions?fid=player.get
```

---

### **5. JSON 视图**（配置 → JSON 视图 Tab）

**功能**：查看函数的完整配置 JSON（只读）

**用途**：
- 查看所有配置信息
- 调试和排查问题
- 导出配置用于手动编辑

---

## 📊 完整工作流程

### **场景 1：配置新函数**

```
1. 访问函数目录 → 看到已导入的函数
   ↓
2. 点击"查看详情"
   ↓
3. 【信息 Tab】编辑函数名称、描述
   ↓
4. 【权限 Tab】配置权限规则
   - 点击"添加规则"
   - 填写 roles: [admin, gm]
   - 点击"保存权限"
   ↓
5. 【配置 → 路由配置 Tab】设置路由
   - 填写 section: "玩家管理"
   - 填写 path: "/game/player/get"
   ↓
6. 完成！✅
```

### **场景 2：修改现有函数权限**

```
1. 访问函数详情页面
   ↓
2. 切换到"权限" Tab
   ↓
3. 找到要修改的规则
   ↓
4. 点击"删除"按钮（或添加新规则）
   ↓
5. 点击"保存权限"按钮
   ↓
6. 看到成功提示 ✅
```

---

## ⚠️ 限制说明

### **当前已支持**（✅ 无需 curl）

- ✅ 基本信息编辑
- ✅ 权限配置（完全可视化）
- ✅ 路由配置查看
- ✅ UI 配置查看
- ✅ 调用历史查看
- ✅ 统计数据查看

### **需要重新打包**（⚠️ 临时方案）

- ⚠️ UI Schema 完整编辑
- ⚠️ 路由配置保存

**原因**：这些配置存储在函数 descriptor 中，需要重新打包。

**临时方案**：
1. 在可视化界面中预览配置
2. 手动编辑 Pack 文件
3. 重新上传 Pack

### **未来计划**（🚀 开发中）

- 🚀 UI Schema 可视化字段编辑器
- 🚋 拖拽式表单构建器
- 🚀 路由配置一键保存
- 🚀 实时预览功能

---

## 🎓 最佳实践

### **1. 权限配置建议**

```yaml
# 管理员专用函数
actions: [invoke, execute, manage]
roles: [admin]

# GM 和操作员可用
actions: [invoke, execute]
roles: [admin, gm, operator]

# 所有用户只读
actions: [read]
roles: [admin, gm, operator, user]
```

### **2. 路由配置建议**

```yaml
# 清晰的路径结构
path: /game/{object}/{action}

# 示例：
- /game/player/get     # 获取玩家
- /game/player/add     # 添加玩家
- /game/item/delete    # 删除物品
- /game/mail/send      # 发送邮件
```

### **3. 菜单分组建议**

```yaml
section: 功能分类  # 一级菜单（玩家管理、物品管理、系统管理等）
group: 子分类      # 二级分组（基础功能、高级功能等）
order: 10         # 同一功能放在一起，使用连续数字
```

---

## 🔗 相关文档

- **Pack 配置**: `/Users/cui/Workspaces/croupier/croupier/packs/player/README.md`
- **完整操作指南**: `/Users/cui/Workspaces/croupier/croupier/OPERATION_GUIDE.md`
- **快速启动**: 运行 `./quick-start.sh`

---

## 💡 常见问题

### Q1: 为什么路由配置保存后没有生效？

A: 当前路由配置需要重新打包 Pack 才能生效。未来版本将支持直接保存。

**临时方案**：
1. 记下在界面中配置的路径
2. 编辑 Pack 的 descriptor 文件
3. 重新打包并上传

### Q2: 权限配置保存后立即生效吗？

A: 是的！权限配置保存后**立即生效**，无需重新打包。

### Q3: 如何查看函数的完整配置？

A: 访问函数详情 → 配置 Tab → JSON 视图

### Q4: 可以在界面上编辑 UI Schema 吗？

A: 目前只能查看，完整编辑功能正在开发中。临时方案是编辑 Pack 文件。

---

## ✅ 总结

现在您可以：
- ✅ **完全不需要 curl 命令**
- ✅ **在 Web 界面完成大部分配置**
- ✅ **权限配置实时生效**
- ⚠️ UI 和路由配置需要重新打包（临时方案）

**作者**: Croupier Team
**更新时间**: 2025-02-01
