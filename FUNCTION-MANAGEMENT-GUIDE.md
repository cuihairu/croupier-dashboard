# 📚 Croupier Dashboard 函数管理页面指南

## 🎯 函数管理页面导航

在 Croupier Dashboard 中，通过 **游戏管理 → 函数管理** 进入函数管理模块。

主要页面路径：
```
主页 → Game Management (游戏管理) → Function Management (函数管理)
```

---

## 📋 核心页面说明

### 1️⃣ **函数目录** (Function Catalog) ⭐

**路由**：`/game/functions/catalog`

**菜单路径**：`游戏管理 > 函数管理 > 函数目录`

**主要功能**：
- ✅ **查看所有已注册的函数**
- ✅ 按类别、标签、风险等级筛选
- ✅ 搜索函数
- ✅ 查看函数详情（点击函数名称）

**适用场景**：
- 📌 查看所有通过 Agent 注册的函数
- 📌 浏览函数目录和分类
- 📌 快速找到需要的函数
- 📌 查看函数的基本信息

**页面内容**：
```
┌─────────────────────────────────────────┐
│  函数目录                              │
├─────────────────────────────────────────┤
│  🔍 搜索: [________________]  筛选 ▼   │
│                                         │
│  分类: ▼ 全部                            │
│  标签: ▼ 全部                            │
│  风险: ▼ 全部                            │
│                                         │
│  函数列表:                               │
│  ┌───────────────────────────────────┐  │
│  │ examples.player.create           │  │
│  │   玩家创建 | 低风险 | 玩家       │  │
│  │   操作：查看详情 | 编辑 | 调用     │  │
│  ├───────────────────────────────────┤  │
│  │ packs.http.generic_invoke      │  │
│  │   HTTP 通用调用 | 低风险 | http   │  │
│  │   操作：查看详情 | 编辑 | 调用     │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
```

---

### 2️⃣ **函数实例** (Function Instances)

**路由**：`/game/functions/instances`

**菜单路径**：`游戏管理 > 函数管理 > 函数实例`

**主要功能**：
- ✅ **查看函数的运行实例**
- ✅ 查看每个实例的健康状态
- ✅ 查看实例分布（Agent、Service）
- ✅ 监控实例负载

**适用场景**：
- 📌 查看函数部署在哪些 Agent/Service 上
- 📌 检查实例健康状态
- 📌 监控函数调用分布
- 📌 故障排查

**页面内容**：
```
┌─────────────────────────────────────────┐
│  函数实例                              │
├─────────────────────────────────────────┤
│  函数: examples.player.create           │
│                                         │
│  实例列表:                              │
│  ┌───────────────────────────────────┐  │
│  │ Agent ID       | 状态  | 负载    │  │
│  │ agent-001      | 🟢 健康  | 20%   │  │
│  │ agent-002      | 🟢 健康  | 35%   │  │
│  │ agent-003      | 🔴 离线  | 0%    │  │
│  └───────────────────────────────────┘  │
└─────────────────────────────────────────┘
```

---

### 3️⃣ **OpenAPI 导入** (OpenAPI Import) 🆕

**路由**：`/game/functions/import-openapi`

**菜单路径**：`游戏管理 > 函数管理 > OpenAPI 导入`

**主要功能**：
- ✅ **导入 OpenAPI 3.0.3 规范**
- ✅ 批量注册函数
- ✅ 查看导入结果
- ✅ 错误处理和回显

**适用场景**：
- 📌 从 OpenAPI 文件批量导入函数
- 📌 快速添加新函数
- 📌 从其他系统迁移函数定义

**页面内容**：
```
┌─────────────────────────────────────────┐
│  导入 OpenAPI 规范                      │
├─────────────────────────────────────────┤
│                                         │
│  粘贴 OpenAPI 规范 (JSON/YAML):         │
│  ┌───────────────────────────────────┐  │
│  │ {                                 │  │
│  │   "openapi": "3.0.3",            │  │
│  │   "info": { ... },                │  │
│  │   "paths": { ... }                │  │
│  │ }                                 │  │
│  │                                   │  │
│  └───────────────────────────────────┘  │
│                                         │
│  [导入函数] [重置]                       │
│                                         │
│  导入结果:                              │
│  ✅ 成功: 13 个函数                      │
│  ⚠️  失败: 0 个函数                      │
└─────────────────────────────────────────┘
```

**使用示例**：
1. 复制你的 OpenAPI YAML/JSON 文件内容
2. 粘贴到文本框
3. 点击 "导入函数"
4. 查看导入结果

---

### 4️⃣ **OpenAPI 规范查看** (OpenAPI Spec)

**路由**：`/game/functions/:id/openapi`

**访问方式**：
- 在函数目录页面点击函数名称
- 在函数详情页面点击 "查看 OpenAPI 规范"

**主要功能**：
- ✅ **查看函数的完整 OpenAPI 规范**
- ✅ 查看请求/响应 Schema
- ✅ 查看扩展字段（x-category, x-risk, etc.）
- ✅ 复制 OpenAPI 规范

**适用场景**：
- 📌 查看函数的完整定义
- 📌 了解请求/响应格式
- 📌 导出函数定义
- 📌 调试和测试

**页面内容**：
```
┌─────────────────────────────────────────┐
│  examples.player.create - OpenAPI 规范  │
├─────────────────────────────────────────┤
│                                         │
│  基本信息:                              │
│  • Operation ID: player.create          │
│  • Summary: 创建玩家账号                 │
│  • Tags: player, create                 │
│  • x-category: player                   │
│  • x-risk: low                          │
│  • x-operation: create                   │
│                                         │
│  请求 Schema:                           │
│  ┌───────────────────────────────────┐  │
│  │ {                                 │  │
│  │   "username": "string",            │  │
│  │   "email": "string",               │  │
│  │   "region": "string"               │  │
│  │ }                                 │  │
│  └───────────────────────────────────┘  │
│                                         │
│  响应 Schema: (类似)                     │
│                                         │
│  [复制规范]                              │
└─────────────────────────────────────────┘
```

---

### 5️⃣ **函数分配** (Function Assignments)

**路由**：`/game/functions/assignments`

**菜单路径**：`游戏管理 > 函数管理 > 函数分配`

**主要功能**：
- ✅ **管理函数到游戏/环境的分配**
- ✅ 配置函数可见性
- ✅ 设置函数权限

**适用场景**：
- 📌 控制哪些游戏可以看到哪些函数
- 📌 配置函数权限
- 📌 管理函数生命周期

---

### 6️⃣ **Pack 管理** (Function Packs)

**路由**：`/game/functions/packs`

**菜单路径**：`游戏管理 > 函数管理 > Pack 管理`

**主要功能**：
- ✅ **查看和管理 Pack**
- ✅ 导入/导出 Pack
- ✅ 版本管理

**适用场景**：
- 📌 管理 Pack 文件
- 📌 批量导入函数
- 📌 版本控制

---

## 🎯 典型使用流程

### 场景 1: 查看已注册的函数

```
1. 登录 Dashboard
2. 点击 "游戏管理" → "函数管理"
3. 点击 "函数目录"
4. 查看所有已注册的函数
5. 可按类别、标签、风险筛选
```

### 场景 2: 导入新的 OpenAPI 函数

```
1. 准备好 OpenAPI 3.0.3 文件
2. 点击 "函数管理" → "OpenAPI 导入"
3. 粘贴 OpenAPI 规范内容
4. 点击 "导入函数"
5. 查看导入结果
6. 返回 "函数目录" 查看新导入的函数
```

### 场景 3: 查看函数详情

```
方式 1:
  函数目录 → 点击函数名称 → 查看详情

方式 2:
  函数目录 → 点击函数名称 → "查看 OpenAPI 规范"
```

### 场景 4: 监控函数实例

```
1. 点击 "函数管理" → "函数实例"
2. 选择要查看的函数
3. 查看该函数的所有实例
4. 检查实例健康状态
```

---

## 📊 函数状态标识

| 图标 | 含义 |
|------|------|
| 🟢 | 函数正常，实例健康 |
| 🟡 | 函数警告，部分实例异常 |
| 🔴 | 函数异常，无可用实例 |
| ⚠️ | 函数已弃用 |
| 🆕 | 新导入的函数 |

---

## 💡 快速操作

### 在函数目录页面

**函数操作**（每个函数右侧的操作按钮）：
- **查看详情** - 查看函数完整信息
- **编辑** - 修改函数配置
- **调用** - 测试函数
- **查看 OpenAPI** - 查看 OpenAPI 规范

**批量操作**：
- 选择多个函数
- 批量启用/禁用
- 批量导出

---

## 🔍 搜索和筛选

### 搜索功能

在函数目录页面：
```
搜索框输入：
• 函数名称：player.create
• 标签：player
• 分类：player
• 操作类型：create
```

### 筛选选项

**分类筛选**：
- player（玩家）
- inventory（物品）
- chat（聊天）
- monitoring（监控）
- custom（自定义）

**标签筛选**：
- create（创建）
- read（读取）
- update（更新）
- delete（删除）
- custom（自定义）

**风险等级**：
- low（低风险）
- medium（中风险）
- high（高风险）

---

## 📖 相关文档

| 需求 | 文档 |
|------|------|
| **OpenAPI 导入指南** | `services/agent/etc/README-OPENAPI.md` |
| **函数注册配置** | `services/agent/etc/platforms.yaml` |
| **OpenAPI 示例文件** | `services/agent/etc/openapi.example.yaml` |
| **多服务配置** | `services/agent/etc/MULTI-SERVICE-GUIDE.md` |

---

## 🎓 最佳实践

### 1. 函数命名规范

推荐的函数命名：
```
{category}.{entity}.{operation}

示例：
• player.create
• inventory.item.add
• chat.message.send
• monitoring.prom.query
```

### 2. 导入前验证

导入 OpenAPI 文件前：
```bash
# 验证 OpenAPI 格式
swagger-cli validate my-functions.yaml
```

### 3. 版本管理

- 为不同的函数集使用不同的 Pack
- 使用语义化版本号
- 记录函数变更历史

### 4. 权限控制

- 高风险函数需要特殊权限
- 使用函数分配控制可见性
- 定期审计函数访问日志

---

**最后更新**: 2024-02-07
**Dashboard 版本**: 6.0.0
